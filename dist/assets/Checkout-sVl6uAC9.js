import{u as e,f as a,a as t,r as s,j as r,L as l,P as o,H as i,c as n}from"./index-CLZj8LUV.js";import{A as d,c}from"./colombia-BbcR_L8G.js";import{T as m}from"./truck-qo79DoHb.js";import{M as x}from"./map-pin-CGSb1MnS.js";import{C as p}from"./check-BvhC8KH9.js";import{S as u}from"./shield-check-EW1HLaJ8.js";import{C as g}from"./credit-card-Dmo65mFb.js";const h=()=>{var h,y;const{cart:b,getCartTotal:f}=e(),{user:j}=a(),N=t(),[v,w]=s.useState(!1),[k,C]=s.useState({fullName:(null==j?void 0:j.name)||"",email:(null==j?void 0:j.email)||"",legalId:"",address:"",city:"",state:"",phone:(null==j?void 0:j.phone)||"",additionalInfo:""}),[I,P]=s.useState(null),q=e=>{C({...k,[e.target.name]:e.target.value}),P(null)},S=s.useCallback(e=>{console.log("Wompi response:",e);const a=e.transaction;if(!a)return void console.log("No transaction returned from widget (closed?)");const t=null==a?void 0:a.status,s=null==a?void 0:a.reference;N("APPROVED"===t?`/order/${s}/success`:`/order/${s}/failed`)},[N]),E=f();return 0===b.length?r.jsxs("div",{className:"min-h-screen pt-32 text-center bg-white flex flex-col items-center",children:[r.jsx("h1",{className:"text-3xl font-display font-bold text-secondary uppercase mb-4",children:"No hay productos en el carrito"}),r.jsx(l,{to:"/shop",className:"text-primary font-bold underline hover:text-primary-dark transition-colors",children:"Volver a la tienda"})]}):r.jsx(o,{children:r.jsxs("div",{className:"bg-white min-h-screen pt-24 pb-20 relative overflow-hidden",children:[r.jsx("div",{className:"absolute top-0 right-0 w-[600px] h-[600px] bg-pink-50 rounded-full blur-[120px] -z-10 opacity-60"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-[600px] h-[600px] bg-purple-50 rounded-full blur-[120px] -z-10 opacity-60"}),r.jsxs("div",{className:"max-w-7xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-24",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[r.jsx("div",{className:"bg-primary/10 p-3 rounded-2xl",children:r.jsx(m,{className:"w-6 h-6 text-primary"})}),r.jsx("h2",{className:"text-3xl md:text-4xl font-display font-black text-secondary tracking-tight",children:"Pago y Envío"})]}),(null==(h=null==j?void 0:j.addresses)?void 0:h.length)>0&&r.jsxs("div",{className:"mb-8",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3 mb-3",children:"Usar una dirección guardada:"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:j.addresses.map((e,a)=>r.jsxs("button",{type:"button",onClick:()=>((e,a)=>{I===a?(P(null),C({...k,address:"",city:"",state:""})):(C({...k,address:e.street,city:e.city,state:e.state||"",additionalInfo:e.additionalInfo||""}),P(a))})(e,a),className:"flex items-start gap-3 p-4 rounded-2xl border-2 transition-all text-left "+(I===a?"border-primary bg-pink-50/50 shadow-md":"border-gray-100 bg-gray-50 hover:border-pink-200"),children:[r.jsx("div",{className:"mt-1 p-1.5 rounded-full "+(I===a?"bg-primary text-white":"bg-gray-200 text-gray-400"),children:r.jsx(x,{className:"w-3 h-3"})}),r.jsxs("div",{className:"flex-grow",children:[r.jsxs("div",{className:"flex justify-between items-center mb-1",children:[r.jsx("p",{className:"font-bold text-sm "+(I===a?"text-secondary":"text-gray-500"),children:e.name}),I===a&&r.jsx(p,{className:"w-4 h-4 text-primary"})]}),r.jsx("p",{className:"text-[10px] text-gray-400 font-medium leading-tight truncate",children:e.street}),e.additionalInfo&&r.jsx("p",{className:"text-[10px] text-gray-300 font-medium leading-tight truncate",children:e.additionalInfo}),r.jsx("p",{className:"text-[10px] text-gray-400 font-medium leading-tight",children:e.city})]})]},a))})]}),r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(!0);try{const e={orderItems:b.map(e=>({product:e._id,name:e.name,quantity:e.quantity,price:e.price,image:e.image})),shippingAddress:{...k,country:"Colombia"},paymentMethod:"WOMPI",itemsPrice:f(),taxPrice:0,shippingPrice:0,totalPrice:f()},{data:a}=await n.post("/orders",e),{data:t}=await n.post("/payments/signature",{orderId:a._id,amount:f()});new window.WidgetCheckout({currency:"COP",amountInCents:t.amountInCents,reference:t.reference,publicKey:t.publicKey,signature:{integrity:t.signature},redirectUrl:null,onResponse:S}).open(e=>{console.log("Widget abierto",e)})}catch(a){console.error(a),alert("Error iniciando el pago")}finally{w(!1)}},className:"space-y-6",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Nombre Completo"}),r.jsx("input",{type:"text",name:"fullName",value:k.fullName,onChange:q,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm",placeholder:"Ej: Ana Pérez",required:!0})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Email"}),r.jsx("input",{type:"email",name:"email",value:k.email,onChange:q,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm",placeholder:"tu@email.com",required:!0})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"DNI / Cédula / NIT"}),r.jsx("input",{type:"text",name:"legalId",value:k.legalId,onChange:q,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm",placeholder:"Cédula de ciudadanía o NIT",required:!0})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Dirección de Entrega"}),r.jsx("input",{type:"text",name:"address",value:k.address,onChange:q,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm",placeholder:"Calle 123 # 45-67",required:!0})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Detalles Adicionales"}),r.jsx("input",{type:"text",name:"additionalInfo",value:k.additionalInfo,onChange:q,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm",placeholder:"Apto, Torre, Conjunto, Referencia..."})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(d,{label:"Departamento",placeholder:"Selecciona departamento...",value:k.state,onChange:e=>C({...k,state:e,city:""}),options:c.map(e=>e.departamento),required:!0}),r.jsx(d,{label:"Ciudad / Municipio",placeholder:"Selecciona ciudad...",value:k.city,onChange:e=>C({...k,city:e}),options:k.state?(null==(y=c.find(e=>e.departamento===k.state))?void 0:y.ciudades)||[]:c.flatMap(e=>e.ciudades),required:!0})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Teléfono"}),r.jsx("input",{type:"tel",name:"phone",value:k.phone,onChange:q,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm",placeholder:"300 123 4567",required:!0})]}),r.jsxs("button",{type:"submit",disabled:v,className:"w-full bg-secondary text-white py-5 rounded-2xl font-black uppercase tracking-widest text-lg hover:bg-primary transition-all shadow-lg hover:shadow-xl hover:-translate-y-1 mt-6 flex items-center justify-center gap-2 group disabled:opacity-50 disabled:cursor-not-allowed",children:[v?"Cargando Wompi...":"Pagar con Wompi"," ",r.jsx(i,{className:"w-5 h-5 group-hover:fill-white transition-all"})]}),r.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-400 text-xs font-bold uppercase mt-4",children:[r.jsx(u,{className:"w-4 h-4"})," Pago Seguro por Wompi"]})]})]}),r.jsx("div",{children:r.jsxs("div",{className:"bg-white border border-pink-100 p-8 rounded-[2.5rem] shadow-lg sticky top-32",children:[r.jsxs("h3",{className:"text-xl font-display font-black text-secondary uppercase mb-6 flex items-center gap-2",children:[r.jsx(g,{className:"w-5 h-5 text-primary"})," Tu Orden"]}),r.jsx("div",{className:"space-y-6 mb-8 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:b.map(e=>r.jsxs("div",{className:"flex justify-between items-center text-sm group",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-50 mr-4 rounded-xl overflow-hidden border border-gray-100 shadow-sm",children:r.jsx("img",{src:e.image,className:"w-full h-full object-cover"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-bold text-secondary text-base",children:e.name}),r.jsxs("p",{className:"text-gray-400 text-xs font-medium",children:["Qty: ",e.quantity," ",e.selectedVariation&&r.jsx("span",{className:"bg-pink-50 text-primary px-1.5 py-0.5 rounded ml-1",children:e.selectedVariation})]})]})]}),r.jsxs("p",{className:"font-display font-black text-secondary",children:["$",(e.price*(1-(e.discount||0)/100)*e.quantity).toLocaleString()]})]},`${e._id}-${e.selectedVariation}`))}),r.jsxs("div",{className:"border-t border-dashed border-pink-200 pt-6 space-y-3",children:[r.jsxs("div",{className:"flex justify-between text-gray-400 font-medium",children:[r.jsx("span",{children:"Subtotal"}),r.jsxs("span",{children:["$",E.toLocaleString()]})]}),r.jsxs("div",{className:"flex justify-between text-gray-400 font-medium",children:[r.jsx("span",{children:"Envío"}),r.jsx("span",{className:"text-gray-500 font-bold bg-gray-100 px-2 py-0.5 rounded-full text-xs",children:"Contra Entrega"})]}),r.jsxs("div",{className:"flex justify-between items-center text-2xl font-display font-black text-primary pt-2",children:[r.jsx("span",{children:"Total"}),r.jsxs("span",{children:["$",E.toLocaleString()]})]})]})]})})]})]})})};export{h as default};
