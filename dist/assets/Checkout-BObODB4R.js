import{r as e,t as a,u as t,f as r,a as s,j as o,L as n,P as l,H as i,c as d}from"./index-uFpnW5qm.js";import{A as c,c as p}from"./colombia-sG3lnVfw.js";import{T as m}from"./truck-r75tiXI_.js";import{M as x}from"./map-pin-DrL5HxMV.js";import{C as u}from"./check-BcHC8xnz.js";import{S as h}from"./shield-GsiPDEng.js";import{S as g}from"./star-CHAe1k5G.js";import{S as b}from"./shield-check-Byq6EhHF.js";import{S as f}from"./sparkles-tM1jC2_7.js";import{C as y}from"./credit-card-VNYVIPCw.js";var j={};Object.defineProperty(j,"__esModule",{value:!0});var v=j.loadMercadoPago=void 0;const w="https://sdk.mercadopago.com/js/v2",N=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,k="MercadoPago has already been initialized in your window, please remove the duplicate import";let P=null;v=j.loadMercadoPago=()=>(null!==P||(P=new Promise((e,a)=>{if("undefined"!=typeof window){if(window.MercadoPago)return console.warn(k),void e(window.MercadoPago);try{let t=(()=>{for(var e=document.querySelectorAll(`script[src^="${w}"`),a=0;a<e.length;a++){var t=e[a];if(N.test(t.src))return t}return null})();t?console.warn(k):t||(t=(()=>{const e=document.createElement("script");e.src=w;const a=document.head||document.body;if(!a)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return a.appendChild(e),e})()),t.addEventListener("load",()=>{window.MercadoPago?e(window.MercadoPago):a(new Error("MercadoPago.js not available"))}),t.addEventListener("error",()=>{a(new Error("Failed to load MercadoPago.js"))})}catch(t){return void a(t)}}else e(null)})),P);var M=function(e,a,t,r){return new(t||(t=Promise))(function(s,o){function n(e){try{i(r.next(e))}catch(a){o(a)}}function l(e){try{i(r.throw(e))}catch(a){o(a)}}function i(e){var a;e.done?s(e.value):(a=e.value,a instanceof t?a:new t(function(e){e(a)})).then(n,l)}i((r=r.apply(e,a||[])).next())})};class C{static getInstance(){return M(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield v(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}C.publicKey=null,C.options={},C.instanceMercadoPago=void 0,C.loadedInstanceMercadoPago=!1;var E=function(e,a,t,r){return new(t||(t=Promise))(function(s,o){function n(e){try{i(r.next(e))}catch(a){o(a)}}function l(e){try{i(r.throw(e))}catch(a){o(a)}}function i(e){var a;e.done?s(e.value):(a=e.value,a instanceof t?a:new t(function(e){e(a)})).then(n,l)}i((r=r.apply(e,a||[])).next())})};const I=()=>E(void 0,void 0,void 0,function*(){}),S=()=>{},O=e=>{console.error(e)};var T=function(e,a,t,r){return new(t||(t=Promise))(function(s,o){function n(e){try{i(r.next(e))}catch(a){o(a)}}function l(e){try{i(r.throw(e))}catch(a){o(a)}}function i(e){var a;e.done?s(e.value):(a=e.value,a instanceof t?a:new t(function(e){e(a)})).then(n,l)}i((r=r.apply(e,a||[])).next())})};const q=({onReady:t=S,onError:r=O,onSubmit:s=I,customization:o,initialization:n,locale:l,id:i="walletBrick_container"})=>(e.useEffect(()=>{const e={settings:{initialization:n,customization:o,locale:l,callbacks:{onReady:t,onSubmit:s,onError:r}},name:"wallet",containerId:i,controller:"walletBrickController"},a=setTimeout(()=>{(({settings:e,name:a,containerId:t,controller:r})=>{T(void 0,void 0,void 0,function*(){const s=yield C.getInstance(),o=null==s?void 0:s.bricks();window[r]=yield null==o?void 0:o.create(a,t,e)})})(e)},200);return()=>{var e;clearTimeout(a),null===(e=window.walletBrickController)||void 0===e||e.unmount()}},[o,n,t,r,s]),a.createElement("div",{id:i}));((e,a)=>{const t=Object.assign(Object.assign({},a),{frontEndStack:"react"}),r=(s=C.options,o=t,!(Object.keys(s).length===Object.keys(o).length&&Object.keys(s).every(e=>Object.prototype.hasOwnProperty.call(o,e)&&s[e]===o[e])));var s,o;(e!==C.publicKey||r)&&(C.publicKey=e,C.options=t,C.instanceMercadoPago=void 0)})("TEST-5afed917-c538-47b2-9999-7acda2635a26",{locale:"es-CO"});const z=()=>{var a,j;const{cart:v,getCartTotal:w,clearCart:N}=t(),{user:k}=r();s();const[P,M]=e.useState(null),[C,E]=e.useState(!1),[I,S]=e.useState(!1);e.useEffect(()=>{P&&setTimeout(()=>{const e=document.getElementById("mercadopago-button-container");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},500)},[P]);const[O,T]=e.useState({fullName:(null==k?void 0:k.name)||"",email:(null==k?void 0:k.email)||"",address:"",city:"",state:"",phone:(null==k?void 0:k.phone)||"",additionalInfo:""}),[z,$]=e.useState(null),_=e=>{T({...O,[e.target.name]:e.target.value}),$(null)},A=w();return 0===v.length?o.jsxs("div",{className:"min-h-screen pt-32 text-center bg-white flex flex-col items-center",children:[o.jsx("h1",{className:"text-3xl font-display font-bold text-secondary uppercase mb-4",children:"No hay productos en el carrito"}),o.jsx(n,{to:"/shop",className:"text-primary font-bold underline hover:text-primary-dark transition-colors",children:"Volver a la tienda"})]}):o.jsx(l,{children:o.jsxs("div",{className:"bg-white min-h-screen pt-24 pb-20 relative overflow-hidden",children:[o.jsx("div",{className:"absolute top-0 right-0 w-[600px] h-[600px] bg-pink-50 rounded-full blur-[120px] -z-10 opacity-60"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-[600px] h-[600px] bg-purple-50 rounded-full blur-[120px] -z-10 opacity-60"}),o.jsxs("div",{className:"max-w-7xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-24",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[o.jsx("div",{className:"bg-primary/10 p-3 rounded-2xl",children:o.jsx(m,{className:"w-6 h-6 text-primary"})}),o.jsx("h2",{className:"text-3xl md:text-4xl font-display font-black text-secondary tracking-tight",children:"Pago y Envío"})]}),(null==(a=null==k?void 0:k.addresses)?void 0:a.length)>0&&!P&&o.jsxs("div",{className:"mb-8",children:[o.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3 mb-3",children:"Usar una dirección guardada:"}),o.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:k.addresses.map((e,a)=>o.jsxs("button",{type:"button",onClick:()=>((e,a)=>{z===a?($(null),T({...O,address:"",city:"",state:""})):(T({...O,address:e.street,city:e.city,state:e.state||"",additionalInfo:e.additionalInfo||""}),$(a))})(e,a),className:"flex items-start gap-3 p-4 rounded-2xl border-2 transition-all text-left "+(z===a?"border-primary bg-pink-50/50 shadow-md":"border-gray-100 bg-gray-50 hover:border-pink-200"),children:[o.jsx("div",{className:"mt-1 p-1.5 rounded-full "+(z===a?"bg-primary text-white":"bg-gray-200 text-gray-400"),children:o.jsx(x,{className:"w-3 h-3"})}),o.jsxs("div",{className:"flex-grow",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("p",{className:"font-bold text-sm "+(z===a?"text-secondary":"text-gray-500"),children:e.name}),z===a&&o.jsx(u,{className:"w-4 h-4 text-primary"})]}),o.jsx("p",{className:"text-[10px] text-gray-400 font-medium leading-tight truncate",children:e.street}),e.additionalInfo&&o.jsx("p",{className:"text-[10px] text-gray-300 font-medium leading-tight truncate",children:e.additionalInfo}),o.jsx("p",{className:"text-[10px] text-gray-400 font-medium leading-tight",children:e.city})]})]},a))})]}),o.jsxs("form",{onSubmit:async e=>{e.preventDefault(),E(!0);try{const e={orderItems:v.map(e=>({product:e._id,name:e.name,quantity:e.quantity,price:e.price*(1-(e.discount||0)/100),image:e.image})),shippingAddress:{address:O.address,city:O.city,state:O.state,postalCode:"0000",country:"Colombia",additionalInfo:O.additionalInfo},paymentMethod:"Mercado Pago",itemsPrice:w(),taxPrice:0,shippingPrice:0,totalPrice:w()},{data:a}=await d.post("/orders",e),{data:t}=await d.post("/payments/create_preference",{orderId:a._id});if(!t||!t.id)throw new Error("No preference ID received from server");M(t.id)}catch(a){console.error("Checkout error:",a),a.response&&400===a.response.status&&a.response.data.msg?alert(`Error: ${a.response.data.msg}`):alert("Hubo un error al procesar tu orden. Por favor intenta de nuevo.")}finally{E(!1)}},className:"space-y-6",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Nombre Completo"}),o.jsx("input",{type:"text",name:"fullName",value:O.fullName,onChange:_,disabled:!!P,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm disabled:opacity-50",placeholder:"Ej: Ana Pérez",required:!0})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Email"}),o.jsx("input",{type:"email",name:"email",value:O.email,onChange:_,disabled:!!P,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm disabled:opacity-50",placeholder:"tu@email.com",required:!0})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Dirección de Entrega"}),o.jsx("input",{type:"text",name:"address",value:O.address,onChange:_,disabled:!!P,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm disabled:opacity-50",placeholder:"Calle 123 # 45-67",required:!0})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Detalles Adicionales"}),o.jsx("input",{type:"text",name:"additionalInfo",value:O.additionalInfo,onChange:_,disabled:!!P,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm disabled:opacity-50",placeholder:"Apto, Torre, Conjunto, Referencia..."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx(c,{label:"Departamento",placeholder:"Selecciona departamento...",value:O.state,onChange:e=>T({...O,state:e,city:""}),options:p.map(e=>e.departamento),disabled:!!P}),o.jsx(c,{label:"Ciudad / Municipio",placeholder:"Selecciona ciudad...",value:O.city,onChange:e=>T({...O,city:e}),options:O.state?(null==(j=p.find(e=>e.departamento===O.state))?void 0:j.ciudades)||[]:p.flatMap(e=>e.ciudades),disabled:!!P})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase ml-3",children:"Teléfono"}),o.jsx("input",{type:"tel",name:"phone",value:O.phone,onChange:_,disabled:!!P,className:"w-full bg-gray-50 border border-gray-200 p-4 rounded-2xl font-bold text-gray-600 outline-none focus:bg-white focus:border-primary transition-all placeholder:text-gray-300 shadow-sm disabled:opacity-50",placeholder:"300 123 4567",required:!0})]}),P?o.jsxs("div",{id:"mercadopago-button-container",className:"mt-6 animate-fade-in-up",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[o.jsxs("div",{className:"bg-pink-50/50 p-4 rounded-3xl border border-pink-100 flex flex-col items-center text-center",children:[o.jsx("div",{className:"w-10 h-10 bg-white rounded-2xl flex items-center justify-center mb-2 shadow-sm",children:o.jsx(h,{className:"w-5 h-5 text-primary"})}),o.jsx("p",{className:"text-[10px] font-black text-secondary uppercase mb-1",children:"Pago 100%"}),o.jsx("p",{className:"text-[8px] font-bold text-primary tracking-widest uppercase",children:"Encriptado"})]}),o.jsxs("div",{className:"bg-purple-50/50 p-4 rounded-3xl border border-purple-100 flex flex-col items-center text-center",children:[o.jsx("div",{className:"w-10 h-10 bg-white rounded-2xl flex items-center justify-center mb-2 shadow-sm",children:o.jsx(g,{className:"w-5 h-5 text-purple-400"})}),o.jsx("p",{className:"text-[10px] font-black text-secondary uppercase mb-1",children:"Compra 100%"}),o.jsx("p",{className:"text-[8px] font-bold text-purple-400 tracking-widest uppercase",children:"Garantizada"})]})]}),o.jsxs("div",{className:"bg-green-50 text-green-600 p-4 rounded-2xl text-center font-bold mb-4 border border-green-100 flex items-center justify-center gap-2 relative overflow-hidden group",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 w-1 bg-green-400 group-hover:w-full transition-all opacity-10"}),o.jsx(b,{className:"w-5 h-5"})," ¡Orden generada! Paga ahora:"]}),P&&o.jsxs("div",{className:"min-h-[150px] flex flex-col justify-center",children:[!I&&o.jsxs("div",{className:"flex flex-col items-center justify-center py-8 animate-pulse text-primary",children:[o.jsx(f,{className:"w-6 h-6 mb-2 animate-bounce"}),o.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]",children:"Magia en proceso..."})]}),o.jsx(q,{initialization:{preferenceId:P,redirectMode:"modal"},onReady:()=>{S(!0)},onError:e=>{S(!1)}},P)]}),o.jsx("button",{type:"button",onClick:()=>{M(null),S(!1)},className:"w-full text-center text-xs font-bold text-gray-400 uppercase mt-4 hover:text-primary transition-colors",children:"Modificar datos de envío"})]}):o.jsxs("button",{type:"submit",disabled:C,className:"w-full bg-secondary text-white py-5 rounded-2xl font-black uppercase tracking-widest text-lg hover:bg-primary transition-all shadow-lg hover:shadow-xl hover:-translate-y-1 mt-6 flex items-center justify-center gap-2 group disabled:opacity-50 disabled:cursor-not-allowed",children:[C?"Generando Pago...":"Completar Orden"," ",o.jsx(i,{className:"w-5 h-5 group-hover:fill-white transition-all"})]}),o.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-400 text-xs font-bold uppercase mt-4",children:[o.jsx(b,{className:"w-4 h-4"})," Pago 100% Seguro por Mercado Pago"]})]})]}),o.jsx("div",{children:o.jsxs("div",{className:"bg-white border border-pink-100 p-8 rounded-[2.5rem] shadow-lg sticky top-32",children:[o.jsxs("h3",{className:"text-xl font-display font-black text-secondary uppercase mb-6 flex items-center gap-2",children:[o.jsx(y,{className:"w-5 h-5 text-primary"})," Tu Orden"]}),o.jsx("div",{className:"space-y-6 mb-8 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:v.map(e=>o.jsxs("div",{className:"flex justify-between items-center text-sm group",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"w-16 h-16 bg-gray-50 mr-4 rounded-xl overflow-hidden border border-gray-100 shadow-sm",children:o.jsx("img",{src:e.image,className:"w-full h-full object-cover"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-secondary text-base",children:e.name}),o.jsxs("p",{className:"text-gray-400 text-xs font-medium",children:["Qty: ",e.quantity," ",e.selectedVariation&&o.jsx("span",{className:"bg-pink-50 text-primary px-1.5 py-0.5 rounded ml-1",children:e.selectedVariation})]})]})]}),o.jsxs("p",{className:"font-display font-black text-secondary",children:["$",(e.price*(1-(e.discount||0)/100)*e.quantity).toLocaleString()]})]},`${e._id}-${e.selectedVariation}`))}),o.jsxs("div",{className:"border-t border-dashed border-pink-200 pt-6 space-y-3",children:[o.jsxs("div",{className:"flex justify-between text-gray-400 font-medium",children:[o.jsx("span",{children:"Subtotal"}),o.jsxs("span",{children:["$",A.toLocaleString()]})]}),o.jsxs("div",{className:"flex justify-between text-gray-400 font-medium",children:[o.jsx("span",{children:"Envío"}),o.jsx("span",{className:"text-gray-500 font-bold bg-gray-100 px-2 py-0.5 rounded-full text-xs",children:"Contra Entrega"})]}),o.jsxs("div",{className:"flex justify-between items-center text-2xl font-display font-black text-primary pt-2",children:[o.jsx("span",{children:"Total"}),o.jsxs("span",{children:["$",A.toLocaleString()]})]})]})]})})]})]})})};export{z as default};
